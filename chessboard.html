<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chess Board</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div data-component="wrapper"></div>
    <div data-component="controls">
      <form data-component="move-form">
        <input name="move-selected" type="text" />
        <input type="submit" value="Submit" />
      </form>
      <div class="move-console"></div>
    </div>
    <script type="module">
      import {
        generateChessBoard,
        renderToHtml,
        movePiece,
        getPosition
      } from "./lib/chessboard.js";
      const wrapper = document.querySelector("[data-component=wrapper]");

      const history = [];
      const startingBoard = generateChessBoard();
      history.push(startingBoard);
      const table = renderToHtml(startingBoard);
      wrapper.appendChild(table);

      const moveForm = document.querySelector("[data-component=move-form]");
      const moveInput = document.getElementsByName("move-selected")[0];
      const moveConsole = document.querySelector(".move-console");

      const movePieceViaForm = event => {
        event.preventDefault();

        const coordinates = moveInput.value.split("").map(Number);
        const startPosition = coordinates.slice(0, 2);
        const endPosition = coordinates.slice(2, 4);

        // can't move an empty piece / square // check if there is there is an svg or piece value
        // input needs to be a number - slight tweak

        const piece = getPosition(history[history.length - 1], startPosition[0], startPosition[1]).piece

        if (!piece) {
          return (moveConsole.innerHTML += `<div class="error">Error: ${coordinates} is not a valid move. You have not selected a piece!</div>`);
        }

        if (coordinates.length !== 4) {
          return (moveConsole.innerHTML += `<div class="error">Error: ${coordinates} is not a valid move. You have too many numbers!</div>`);
        }
        if (
          coordinates.some(coordinate => {
            return coordinate > 7;
          })
        ) {
          return (moveConsole.innerHTML += `<div class="error">Error: ${coordinates} is not a valid move. You have fallen off the board!</div>`);
        }

        const newBoard = movePiece(
          history[history.length - 1],
          startPosition,
          endPosition
        );
        history.push(newBoard);
        wrapper.innerHTML = "";
        moveInput.value = "";
        const newTable = renderToHtml(newBoard);
        wrapper.appendChild(newTable);
        wrapper.appendChild(moveForm);

        moveConsole.innerHTML += `<div class="success">Successful move: [${startPosition}, ${endPosition}]</div>`;
      };

      moveForm.addEventListener("submit", movePieceViaForm);

      // move piece via the console by calling this function with two arrays for start and end position:
      window.movePiece = (startPosition, endPosition) => {
        const newBoard = movePiece(
          history[history.length - 1],
          startPosition,
          endPosition
        );
        history.push(newBoard);
        wrapper.innerHTML = "";
        const newTable = renderToHtml(newBoard);
        wrapper.appendChild(newTable);
      };
    </script>
  </body>
</html>

<!-- Serve the page with http-server and letting it default to the correct file -->
<!-- Initial console version - move a piece by calling `window.movePiece([1,1],[4,4])` -->
